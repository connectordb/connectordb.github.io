---
layout: default
---

<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.css" rel="stylesheet">
<style type="text/css">
	.CodeMirror {
		border: 1px solid black;
		height: 500px;
	}

	.radio-inline {
		display: inline-block;
		margin-left: 10px;
	}
	.rinput {
		box-sizing: content-box;
	}

</style>
<!-- Main -->
<section id="main" class="wrapper style1">
	<header class="major">
		<h2>PipeScript</h2>
		<p>A stream processing language</p>
		<a href="./docs/basics.html" class="button big alt">Tutorial</a>
	</header>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/javascript/javascript.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/addon/edit/matchbrackets.min.js"></script>
	<div class="container">
		<div class="row">
			<div class="9u">

					<div style="width:100%;">
						<div style="display:inline-block;width:90%;">
							<input type="text" class="form-control" id="script" style="font-family:monospace;" value="map( $['activity'] , $['steps']:sum )">
						</div>
						<div style="display:inline-block;width:8%;">
							<input type="submit" id="scriptbtn" style="padding:0 0.25cm;"></input>
						</div>
					</div>
				</form>
			</div>
			<div class="3u" style="vertical-align: bottom;">
				<label class="radio-inline" for="dprb">
					<input id="dprb" type="radio" name="optradio" value="dp" onchange="setdp();" class="rinput" checked>Datapoint</label>

				<label class="radio-inline" for="csvrb">
					<input id="csvrb" type="radio" name="optradio" onchange="setcsv();" value="csv" class="rinput">CSV</label>

				<label class="radio-inline" for="jsonrb">
					<input id="jsonrb" type="radio" name="optradio" onclick="setjson();" value="json" class="rinput">JSON</label>
				<script>
				function setdp() {
					input.setValue(dpvalue);
					runScript();
				}
				function setcsv() {
					input.setValue(csvvalue);
					runScript();
				}
				function setjson() {
					input.setValue(jsonvalue);
					runScript();
				}
				</script>
			</div>
		</div>
		<div class="row" style="margin-top: 1cm;">

			<div class="6u">
				<textarea id="input"></textarea>
			</div>
			<div class="6u">
				<textarea id="output"></textarea>
			</div>

			<script>

				var dpvalue = JSON.stringify(JSON.parse(
					'[{"t": 145417065,"d": {"steps": 14,"activity": "walking"}},\
				{"t": 145511065,"d": { "steps": 10,"activity": "running"}},\
				{"t": 145513065,"d": {"steps": 12,"activity": "walking"}},\
				{"t": 145517065,"d": {"steps": 5,"activity": "running"}}]'
			), null, 2);
				var jsonvalue = `[
  {
    "t": "1974-08-11T01:37:45+00:00",
    "steps": 14,
    "activity": "walking"
},
  {
    "t": "1974-08-12T03:44:25+00:00",
    "steps": 10,
    "activity": "running"
},
  {
    "t": "1974-08-12T04:17:45+00:00",
    "steps": 12,
    "activity": "walking"
},
  {
    "t": "1974-08-12T05:24:25+00:00",
    "steps": 5,
    "activity": "running"
}]`;
				var csvvalue = 'time,steps,activity\n\
1974-08-11T01:37:45+00:00,14,walking\n\
1974-08-12T03:44:25+00:00,10,running\n\
1974-08-12T04:17:45+00:00, 12,walking\n\
1974-08-12T05:24:25+00:00,5,running';


				var input = CodeMirror.fromTextArea(document.getElementById("input"), {
					matchBrackets: true,
					autoCloseBrackets: true,
					mode: "application/json",
					lineWrapping: true
				});
				var output = CodeMirror.fromTextArea(document.getElementById("output"), {
					matchBrackets: true,
					autoCloseBrackets: true,
					mode: "application/json",
					lineWrapping: true,
					readOnly: true
				});

				input.setValue(dpvalue);

				output.setValue("Loading PipeScript...");

			</script>

		</div>
		<hr class="major" />

		<!-- About Section -->
		<section id="transforms" class="transforms-section">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<h1>Transforms</h1>
						<div id="searchable">

							<input class="search search-query form-control" type="text" placeholder="Search" />
							<br />
							<table class="table table-striped table-bordered" id="ftable">
								<thead>
									<th>Name</th>
									<th>Description</th>
									<th>Arguments</th>
								</thead>
								<!-- IMPORTANT, class="list" have to be at tbody -->
								<tbody class="list">

								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</section>

	</div>
</section>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.1.1/list.min.js"></script>
<script type="text/javascript" src="pipescript.js"></script>
<script>
	function runScript() {
		output.setValue("Running...");
		s = pipescript.Script($("#script").val());
		if (!s.IsValid()) {
			output.setValue(s.Error());
		}
		result = s.Run(input.getValue(),$("input[name=optradio]:checked").val());
		if (!s.IsValid()) {
			output.setValue(s.Error());
		} else {
			output.setValue(result);
		}
	}

	runScript();

	$("#scriptbtn").click(function(e) {
		e.preventDefault();
		runScript();
	});


	// Now set up the transform list
	data = JSON.parse(pipescript.Transforms())

	// http://stackoverflow.com/questions/684672/loop-through-javascript-object
	for (var key in data) {
		if (data.hasOwnProperty(key)) {
			console.log(key);
			var v = data[key];

			var fdata = "<tr><td class='fname'>" + key + "</td><td class='fdesc'>" + v.description + "</td><td class='farg'><ol>";
			for (d in v.args) {
				var cv = v.args[d];
				fdata += "<li>";
				if (cv.optional) {
					fdata += "<i>(optional)</i> - ";
				}
				fdata += cv.description + "</li>";
			}
			fdata += "</ol>";


			$('#ftable tbody').append(fdata);
		}
	}

	//Set up the search box
	var options = {
		valueNames: ["fname", "fdesc", "farg"]
	};
	var flist = new List("searchable", options);

</script>
