---
layout: default
---

<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.css" rel="stylesheet">
<style type="text/css">
	.CodeMirror {
		border: 1px solid black;
		height: 500px;
	}

</style>
<!-- Main -->
<section id="main" class="wrapper style1">
	<header class="major">
		<h2>PipeScript</h2>
		<p>A JSON stream processing language</p>
		<a href="./docs/basics.html" class="button big alt">Tutorial</a>
	</header>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/javascript/javascript.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/addon/edit/matchbrackets.min.js"></script>
	<div class="container">
		<div class="row">
			<div class="12u">
				<form>
					<div style="width:100%;">
						<div style="display:inline-block;width:80%;">
							<input type="text" class="form-control" id="script" style="font-family:monospace;" value="map( $['activity'] , $['steps']:sum )">
						</div>
						<div style="display:inline-block;width:18%;">
							<input type="submit" id="scriptbtn"></input>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="row">

			<div class="6u">
				<textarea id="input"></textarea>
			</div>
			<div class="6u">
				<textarea id="output"></textarea>
			</div>

			<script>
				var input = CodeMirror.fromTextArea(document.getElementById("input"), {
					matchBrackets: true,
					autoCloseBrackets: true,
					mode: "application/json",
					lineWrapping: true
				});
				var output = CodeMirror.fromTextArea(document.getElementById("output"), {
					matchBrackets: true,
					autoCloseBrackets: true,
					mode: "application/json",
					lineWrapping: true,
					readOnly: true
				});

				input.setValue(JSON.stringify(JSON.parse(
					'[{"t": 145417065,"d": {"steps": 14,"activity": "walking"}},\
				{"t": 145511065,"d": { "steps": 10,"activity": "running"}},\
				{"t": 145513065,"d": {"steps": 12,"activity": "walking"}},\
				{"t": 145517065,"d": {"steps": 5,"activity": "running"}}]'
				), null, 2));

				output.setValue("Loading PipeScript...");

			</script>

		</div>
		<hr class="major" />

		<!-- About Section -->
		<section id="transforms" class="transforms-section">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<h1>Transforms</h1>
						<div id="searchable">

							<input class="search search-query form-control" type="text" placeholder="Search" />
							<br />
							<table class="table table-striped table-bordered" id="ftable">
								<thead>
									<th>Name</th>
									<th>Description</th>
									<th>Arguments</th>
								</thead>
								<!-- IMPORTANT, class="list" have to be at tbody -->
								<tbody class="list">

								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</section>

	</div>
</section>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.1.1/list.min.js"></script>
<script type="text/javascript" src="pipescript.js"></script>
<script>
	function runScript() {
		output.setValue("Running...");
		s = pipescript.Script($("#script").val());
		if (!s.IsValid()) {
			output.setValue(s.Error());
		}
		result = s.Run(input.getValue());
		if (!s.IsValid()) {
			output.setValue(s.Error());
		} else {
			output.setValue(result);
		}
	}

	runScript();

	$("#scriptbtn").click(function(e) {
		e.preventDefault();
		runScript();
	});


	// Now set up the transform list
	data = JSON.parse(pipescript.Transforms())

	// http://stackoverflow.com/questions/684672/loop-through-javascript-object
	for (var key in data) {
		if (data.hasOwnProperty(key)) {
			console.log(key);
			var v = data[key];

			var fdata = "<tr><td class='fname'>" + key + "</td><td class='fdesc'>" + v.description + "</td><td class='farg'><ol>";
			for (d in v.args) {
				var cv = v.args[d];
				fdata += "<li>";
				if (cv.optional) {
					fdata += "<i>(optional)</i> - ";
				}
				fdata += cv.description + "</li>";
			}
			fdata += "</ol>";


			$('#ftable tbody').append(fdata);
		}
	}

	//Set up the search box
	var options = {
		valueNames: ["fname", "fdesc", "farg"]
	};
	var flist = new List("searchable", options);

</script>
